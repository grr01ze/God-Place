<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Godplace Panel</title>
<style>
  /* Styles inchangés */
  * {
    margin: 0; padding: 0; box-sizing: border-box;
  }
  body {
    background: white;
    color: #000;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    padding: 20px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  h1, h2 {
    color: #d4af37;
    font-weight: bold;
    margin-bottom: 15px;
  }
  h1 {
    font-size: 2.5rem;
    text-align: center;
    margin-bottom: 30px;
  }
  h2 {
    font-size: 1.5rem;
    border-bottom: 2px solid #d4af37;
    padding-bottom: 5px;
    margin-top: 30px;
  }
  select, button {
    font-size: 1rem;
    padding: 10px 15px;
    border-radius: 6px;
    border: 2px solid #d4af37;
    background: white;
    color: #d4af37;
    cursor: pointer;
    font-weight: 600;
    user-select: none;
    margin: 8px 8px 8px 0;
    min-width: 140px;
  }
  select:focus, button:focus {
    outline: none;
    background: #d4af37;
    color: white;
  }
  button:disabled {
    opacity: 0.5;
    cursor: default;
  }
  .buttons-group {
    display: flex;
    flex-wrap: wrap;
    margin-top: 15px;
  }
  .preview {
    margin-top: 25px;
    text-align: center;
  }
  .preview img {
    max-width: 100%;
    max-height: 350px;
    border: 2px solid #d4af37;
    border-radius: 8px;
    box-shadow: 0 0 10px #d4af37aa;
  }
  .actions {
    margin-top: 30px;
  }
  .logs {
    background-color: #fffbea;
    border: 1.5px solid #d4af37;
    color: #6b5e00;
    padding: 12px 15px;
    border-radius: 6px;
    font-family: monospace;
    white-space: pre-wrap;
    max-height: 150px;
    overflow-y: auto;
    margin-top: 15px;
  }
  /* Responsive */
  @media(max-width: 600px) {
    .buttons-group {
      flex-direction: column;
    }
    select, button {
      min-width: 100%;
      margin-bottom: 10px;
    }
  }
</style>
</head>
<body>

<h1>Godplace Panel</h1>

<section>
  <h2>1. Choisissez une catégorie</h2>
  <select id="categorySelect" aria-label="Choisir une catégorie">
    <option value="">-- Sélectionnez une catégorie --</option>
    <option value="mondeEnDeclin">Le Monde en Déclin</option>
    <option value="gagneCoeurChrist">Gagne le cœur du Christ</option>
    <option value="loueAvecTonArt">Loue avec ton art</option>
    <option value="chaineSacree">Chaîne sacrée</option>
    <option value="savoirChretien">Savoir chrétien</option>
    <option value="jePrefere">Je préfère</option>
    <option value="jeDebats">Je débats</option>
    <option value="composeTonChant">Compose ton chant</option>
    <option value="priereEnChoeur">Prière en chœur</option>
    <option value="quiSuisJeBiblique">Qui suis-je biblique</option>
    <option value="comprendreApocalypse">Comprendre l'apocalypse</option>
    <option value="bibleIllustree">LA Bible illustrée</option>
    <option value="cinemaChretien">Cinéma Chrétien</option>
    <option value="jeux">Jeux</option>
  </select>
</section>

<section>
  <h2>2. Choisissez un élément</h2>
  <div id="buttonsContainer" class="buttons-group"></div>
</section>

<section>
  <h2>3. Aperçu</h2>
  <div id="previewContainer" class="preview">
    <p>Sélectionnez un élément pour voir l'aperçu ici.</p>
  </div>
</section>

<section class="actions">
  <label for="channelSelect"><h2>4. Choisissez un salon Discord (si applicable)</h2></label>
  <select id="channelSelect" aria-label="Choisir un salon Discord" style="display:none;"></select>
  
  <button id="backButton" style="display:none;">Retour</button>
  <button id="sendButton" disabled>Envoyer au bot Discord</button>
</section>

<section>
  <h2>Logs des actions</h2>
  <pre id="logs" class="logs">Aucune action pour l'instant.</pre>
</section>

<script>
  const fixedChannels = {
    "grilleDeLumiere": "1378679774742056974",
    "eclaireurs": "1378680922928320653"
  };

  const availableChannels = {
    "1378679774742056974": "Salon Grille de lumière",
    "1378680922928320653": "Salon Éclaireurs",
    "1325922071473295411": "Salon Général",
    "1378679000000000001": "Salon Annonces",
    "1365417738436087909": "Je préfères G1",
    "1365417832774635540": "Je préfères G2",
  };

  const categories = {
    mondeEnDeclin: {
      "Semaine 1": "https://media.discordapp.net/attachments/1365412596655853699/1365725262414876693/FICHES_SPECIFIQUES_PETIT_FORMAT_-_4.png",
      "Semaine 2": "https://media.discordapp.net/attachments/1365412596655853699/1365725295369388042/FICHES_SPECIFIQUES_PETIT_FORMAT_-_5.png",
      "Semaine 3": "https://media.discordapp.net/attachments/1365412596655853699/1365725348314222754/FICHES_SPECIFIQUES_PETIT_FORMAT_-_6.png",
    },
    gagneCoeurChrist: {
      "Semaine 1": "https://media.discordapp.net/attachments/1365412596655853699/1365725653625864284/FICHES_SPECIFIQUES_PETIT_FORMAT_-_13.png",
      "Semaine 2": "https://media.discordapp.net/attachments/1365412596655853699/1365725697045434488/FICHES_SPECIFIQUES_PETIT_FORMAT_-_14.png",
      "Semaine 3": "https://media.discordapp.net/attachments/1365412596655853699/1365725725654782062/FICHES_SPECIFIQUES_PETIT_FORMAT_-_15.png"
    },
    loueAvecTonArt: {
      "Semaine 1": "https://media.discordapp.net/attachments/1365412596655853699/1365725770085040218/FICHES_SPECIFIQUES_PETIT_FORMAT_-_16.png",
      "Semaine 2": "https://media.discordapp.net/attachments/1365412596655853699/1365725825047068722/FICHES_SPECIFIQUES_PETIT_FORMAT_-_17.png",
      "Semaine 3": "https://media.discordapp.net/attachments/1365412596655853699/1365725866457567416/FICHES_SPECIFIQUES_PETIT_FORMAT_-_18.png"
    },
    chaineSacree: {
      "Semaine 1": "https://media.discordapp.net/attachments/1365412596655853699/1365725911411851344/FICHES_SPECIFIQUES_PETIT_FORMAT_-_19.png",
      "Semaine 2": "https://media.discordapp.net/attachments/1365412596655853699/1365725981528166450/FICHES_SPECIFIQUES_PETIT_FORMAT_-_20.png",
      "Semaine 3": "https://media.discordapp.net/attachments/1365412596655853699/1365726016988465158/FICHES_SPECIFIQUES_PETIT_FORMAT_-_21.png"
    },
    savoirChretien: {
      "Semaine 1": "https://media.discordapp.net/attachments/1365412596655853699/1365726058002784767/FICHES_SPECIFIQUES_PETIT_FORMAT_-_22.png",
      "Semaine 2": "https://media.discordapp.net/attachments/1365412596655853699/1365726094986149378/FICHES_SPECIFIQUES_PETIT_FORMAT_-_23.png",
      "Semaine 3": "https://media.discordapp.net/attachments/1365412596655853699/1365726124882736641/FICHES_SPECIFIQUES_PETIT_FORMAT_-_24.png"
    },
    jePrefere: {
      "Semaine 1": "https://media.discordapp.net/attachments/1365412596655853699/1365726155632450067/FICHES_SPECIFIQUES_PETIT_FORMAT_-_25.png",
      "Semaine 2": "https://media.discordapp.net/attachments/1365412596655853699/1365726183903265536/FICHES_SPECIFIQUES_PETIT_FORMAT_-_26.png",
      "Semaine 3": "https://media.discordapp.net/attachments/1365412596655853699/1365726215589114901/FICHES_SPECIFIQUES_PETIT_FORMAT_-_27.png"
    },
    jeDebats: {
      "Semaine 1": "https://media.discordapp.net/attachments/1365412596655853699/1365726250338652418/FICHES_SPECIFIQUES_PETIT_FORMAT_-_28.png",
      "Semaine 2": "https://media.discordapp.net/attachments/1365412596655853699/1365726283172867072/FICHES_SPECIFIQUES_PETIT_FORMAT_-_29.png",
      "Semaine 3": "https://media.discordapp.net/attachments/1365412596655853699/1365726313883936275/FICHES_SPECIFIQUES_PETIT_FORMAT_-_30.png"
    },
    composeTonChant: {
      "Semaine 1": "https://media.discordapp.net/attachments/1365412596655853699/1365726345386018823/FICHES_SPECIFIQUES_PETIT_FORMAT_-_31.png",
      "Semaine 2": "https://media.discordapp.net/attachments/1365412596655853699/1365726374519505411/FICHES_SPECIFIQUES_PETIT_FORMAT_-_32.png",
      "Semaine 3": "https://media.discordapp.net/attachments/1365412596655853699/1365726412025523506/FICHES_SPECIFIQUES_PETIT_FORMAT_-_33.png"
    },
    priereEnChoeur: {
      "Semaine 1": "https://media.discordapp.net/attachments/1365412596655853699/1365726445561549856/FICHES_SPECIFIQUES_PETIT_FORMAT_-_34.png",
      "Semaine 2": "https://media.discordapp.net/attachments/1365412596655853699/1365726477503522300/FICHES_SPECIFIQUES_PETIT_FORMAT_-_35.png",
      "Semaine 3": "https://media.discordapp.net/attachments/1365412596655853699/1365726504952314986/FICHES_SPECIFIQUES_PETIT_FORMAT_-_36.png"
    },
    quiSuisJeBiblique: {
      "Semaine 1": "https://media.discordapp.net/attachments/1365412596655853699/1365726536286921778/FICHES_SPECIFIQUES_PETIT_FORMAT_-_37.png",
      "Semaine 2": "https://media.discordapp.net/attachments/1365412596655853699/1365726566499025000/FICHES_SPECIFIQUES_PETIT_FORMAT_-_38.png",
      "Semaine 3": "https://media.discordapp.net/attachments/1365412596655853699/1365726598318859014/FICHES_SPECIFIQUES_PETIT_FORMAT_-_39.png"
    },
    comprendreApocalypse: {
      "Semaine 1": "https://media.discordapp.net/attachments/1365412596655853699/1365726630002579476/FICHES_SPECIFIQUES_PETIT_FORMAT_-_40.png",
      "Semaine 2": "https://media.discordapp.net/attachments/1365412596655853699/1365726663403672848/FICHES_SPECIFIQUES_PETIT_FORMAT_-_41.png",
      "Semaine 3": "https://media.discordapp.net/attachments/1365412596655853699/1365726700276018184/FICHES_SPECIFIQUES_PETIT_FORMAT_-_42.png"
    },
    bibleIllustree: {
      "Semaine 1": "https://media.discordapp.net/attachments/1365412596655853699/1365726733322940924/FICHES_SPECIFIQUES_PETIT_FORMAT_-_43.png",
      "Semaine 2": "https://media.discordapp.net/attachments/1365412596655853699/1365726763165978650/FICHES_SPECIFIQUES_PETIT_FORMAT_-_44.png",
      "Semaine 3": "https://media.discordapp.net/attachments/1365412596655853699/1365726794945651970/FICHES_SPECIFIQUES_PETIT_FORMAT_-_45.png"
    },
    cinemaChretien: {
      "Semaine 1": "https://media.discordapp.net/attachments/1365412596655853699/1365726824389902396/FICHES_SPECIFIQUES_PETIT_FORMAT_-_46.png",
      "Semaine 2": "https://media.discordapp.net/attachments/1365412596655853699/1365726860361834760/FICHES_SPECIFIQUES_PETIT_FORMAT_-_47.png",
      "Semaine 3": "https://media.discordapp.net/attachments/1365412596655853699/1365726891917857532/FICHES_SPECIFIQUES_PETIT_FORMAT_-_48.png"
    },
    jeux: {
      "Grille de lumière": {
        "Bouton 1": "https://media.discordapp.net/attachments/1365412596655853699/1365726955667652608/FICHES_SPECIFIQUES_PETIT_FORMAT_-_49.png",
        "Bouton 2": "https://media.discordapp.net/attachments/1365412596655853699/1365726985450347310/FICHES_SPECIFIQUES_PETIT_FORMAT_-_50.png",
        "Bouton 3": "https://media.discordapp.net/attachments/1365412596655853699/1365727015886677760/FICHES_SPECIFIQUES_PETIT_FORMAT_-_51.png"
      },
      "Éclaireurs": {
        "Bouton 1": "https://media.discordapp.net/attachments/1365412596655853699/1365727045944965234/FICHES_SPECIFIQUES_PETIT_FORMAT_-_52.png",
        "Bouton 2": "https://media.discordapp.net/attachments/1365412596655853699/1365727074408728320/FICHES_SPECIFIQUES_PETIT_FORMAT_-_53.png",
        "Bouton 3": "https://media.discordapp.net/attachments/1365412596655853699/1365727103434525440/FICHES_SPECIFIQUES_PETIT_FORMAT_-_54.png"
      }
    }
  };

  const categorySelect = document.getElementById("categorySelect");
  const buttonsContainer = document.getElementById("buttonsContainer");
  const previewContainer = document.getElementById("previewContainer");
  const sendButton = document.getElementById("sendButton");
  const channelSelect = document.getElementById("channelSelect");
  const backButton = document.getElementById("backButton");
  const logs = document.getElementById("logs");

  let selectedCategory = null;
  let selectedKey = null;
  let selectedURL = null;
  let selectedSubGame = null;

  // Afficher les boutons selon la catégorie choisie
  categorySelect.addEventListener("change", () => {
    selectedCategory = categorySelect.value;
    selectedKey = null;
    selectedURL = null;
    selectedSubGame = null;
    previewContainer.innerHTML = "<p>Sélectionnez un élément pour voir l'aperçu ici.</p>";
    sendButton.disabled = true;
    backButton.style.display = "none";
    channelSelect.style.display = "none";
    channelSelect.innerHTML = "";

    buttonsContainer.innerHTML = "";

    if (!selectedCategory) return;

    // Gestion spéciale pour catégorie jeux
    if (selectedCategory === "jeux") {
      // Affiche 2 boutons pour choisir sous-jeu
      const grilleBtn = document.createElement("button");
      grilleBtn.textContent = "Grille de lumière";
      grilleBtn.onclick = () => showJeuButtons("Grille de lumière");
      buttonsContainer.appendChild(grilleBtn);

      const eclaireursBtn = document.createElement("button");
      eclaireursBtn.textContent = "Éclaireurs";
      eclaireursBtn.onclick = () => showJeuButtons("Éclaireurs");
      buttonsContainer.appendChild(eclaireursBtn);

      return;
    }

    // Sinon affichage classique des boutons
    const items = categories[selectedCategory];
    if (!items) return;

    Object.keys(items).forEach((key) => {
      const btn = document.createElement("button");
      btn.textContent = key;
      btn.onclick = () => {
        selectedKey = key;
        selectedURL = items[key];
        selectedSubGame = null;
        previewContainer.innerHTML = `<img src="${selectedURL}" alt="${key} - ${selectedCategory}" />`;
        sendButton.disabled = false;
        backButton.style.display = "none";
        channelSelect.style.display = "none";
        channelSelect.innerHTML = "";
      };
      buttonsContainer.appendChild(btn);
    });
  });

  function showJeuButtons(subGameName) {
    selectedSubGame = subGameName;
    selectedKey = null;
    selectedURL = null;
    previewContainer.innerHTML = "<p>Sélectionnez un élément pour voir l'aperçu ici.</p>";
    sendButton.disabled = true;

    buttonsContainer.innerHTML = "";
    backButton.style.display = "inline-block";
    channelSelect.style.display = "inline-block";

    // Remplir la sélection des salons Discord en fonction du sous-jeu
    channelSelect.innerHTML = "";

    // Pour jeux, on impose les salons fixes
    if (subGameName === "Grille de lumière") {
      const option = document.createElement("option");
      option.value = fixedChannels.grilleDeLumiere;
      option.textContent = availableChannels[fixedChannels.grilleDeLumiere] || "Salon Grille de lumière";
      channelSelect.appendChild(option);
      channelSelect.value = fixedChannels.grilleDeLumiere;
      channelSelect.disabled = true;
    } else if (subGameName === "Éclaireurs") {
      const option = document.createElement("option");
      option.value = fixedChannels.eclaireurs;
      option.textContent = availableChannels[fixedChannels.eclaireurs] || "Salon Éclaireurs";
      channelSelect.appendChild(option);
      channelSelect.value = fixedChannels.eclaireurs;
      channelSelect.disabled = true;
    } else {
      // fallback
      channelSelect.disabled = false;
      Object.entries(availableChannels).forEach(([id, name]) => {
        const option = document.createElement("option");
        option.value = id;
        option.textContent = name;
        channelSelect.appendChild(option);
      });
    }

    // Afficher les boutons de l'un des deux sous-jeux
    const jeuxItems = categories.jeux[subGameName];
    if (!jeuxItems) return;

    Object.keys(jeuxItems).forEach((key) => {
      const btn = document.createElement("button");
      btn.textContent = key;
      btn.onclick = () => {
        selectedKey = key;
        selectedURL = jeuxItems[key];
        previewContainer.innerHTML = `<img src="${selectedURL}" alt="${selectedSubGame} - ${key}" />`;
        sendButton.disabled = false;
      };
      buttonsContainer.appendChild(btn);
    });
  }

  backButton.addEventListener("click", () => {
    // Retour à la sélection des sous-jeux (Grille/Éclaireurs)
    if (selectedCategory === "jeux") {
      buttonsContainer.innerHTML = "";
      backButton.style.display = "none";
      sendButton.disabled = true;
      previewContainer.innerHTML = "<p>Sélectionnez un élément pour voir l'aperçu ici.</p>";
      channelSelect.style.display = "none";
      channelSelect.innerHTML = "";
      selectedKey = null;
      selectedURL = null;
      selectedSubGame = null;

      // Remet les 2 boutons pour sous-jeux
      const grilleBtn = document.createElement("button");
      grilleBtn.textContent = "Grille de lumière";
      grilleBtn.onclick = () => showJeuButtons("Grille de lumière");
      buttonsContainer.appendChild(grilleBtn);

      const eclaireursBtn = document.createElement("button");
      eclaireursBtn.textContent = "Éclaireurs";
      eclaireursBtn.onclick = () => showJeuButtons("Éclaireurs");
      buttonsContainer.appendChild(eclaireursBtn);
    }
  });

  sendButton.addEventListener("click", () => {
    if (!selectedURL || !selectedKey || !selectedCategory) {
      alert("Veuillez sélectionner une image avant d'envoyer.");
      return;
    }

    // channelId pris soit depuis le select si visible, sinon salon par défaut
    const channelId = channelSelect.style.display !== "none" && channelSelect.value
      ? channelSelect.value
      : availableChannels["1325922071473295411"]; // ID salon général par défaut

    // Construire le message texte envoyé au bot Discord
    const message = `${selectedKey} (${selectedSubGame ? selectedSubGame : selectedCategory})\n${selectedURL}`;

    const payload = {
      channelId: channelId,
      message: message
    };

    sendButton.disabled = true;
    sendButton.textContent = "Envoi en cours...";

    fetch("https://bot-production-e4ec.up.railway.app/send", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(payload)
    })
    .then((response) => {
      if (!response.ok) {
        throw new Error(`Erreur serveur: ${response.status}`);
      }
      return response.text();
    })
    .then((text) => {
      addLog(`✔️ Envoyé : ${message}\nRéponse: ${text}`);
    })
    .catch((err) => {
      addLog(`❌ Erreur lors de l'envoi : ${err.message}`);
    })
    .finally(() => {
      sendButton.disabled = false;
      sendButton.textContent = "Envoyer au bot Discord";
    });
  });

  function addLog(text) {
    const now = new Date();
    const time = now.toLocaleTimeString();
    if (logs.textContent === "Aucune action pour l'instant.") {
      logs.textContent = "";
    }
    logs.textContent += `[${time}] ${text}\n`;
    logs.scrollTop = logs.scrollHeight;
  }

  // Initialisation
  function init() {
    sendButton.disabled = true;
    backButton.style.display = "none";
    channelSelect.style.display = "none";
    previewContainer.innerHTML = "<p>Sélectionnez une catégorie pour commencer.</p>";
  }

  init();
</script>

</body>
</html>
